<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="beter">
<title>Understanding configuration files • beter</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Understanding configuration files">
<meta property="og:description" content="beter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">beter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/beter.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/config.html">Understanding configuration files</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/biods/beter/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="config_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Understanding configuration files</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biods/beter/blob/HEAD/vignettes/config.Rmd" class="external-link"><code>vignettes/config.Rmd</code></a></small>
      <div class="d-none name"><code>config.Rmd</code></div>
    </div>

    
    
<p>One problem with BEAST2 is the structure of it’s XMLs. For example, typical BEAST2 XML consist of following parts:</p>
<pre><code>&lt;sequences&gt;
&lt;parameters&gt;
&lt;priors&gt;
&lt;population model&gt;
&lt;substitution model&gt;
&lt;clock model&gt;
&lt;operators&gt;
&lt;loggers&gt;</code></pre>
<p>In theory, you should be able to easily switch between various population, substitution models. In practice, this is not easy at all as changing a substitution model means editing parameters, operators and loggers. There is just no easy way to go around this other than developing a tool that takes inputs and tries to transform them into BEAST2 XMLs.</p>
<p>In essence, this is exactly what <strong>beter</strong> does by creating templates out of XMLs together with configs.</p>
<div class="section level2">
<h2 id="what-is-config">What is config?<a class="anchor" aria-label="anchor" href="#what-is-config"></a>
</h2>
<p>Configs are beter configuration files, partners to the XML templates. For human readability, instead of XML, beter configs are written in the <a href="https://toml.io/" class="external-link">TOML language</a>, and they consist of three parts: <code>xml</code>, <code>templates</code> and <code>defaults</code>. A sample config might look like this:</p>
<pre><code>[xml]
operators = """
        &lt;operator id='uniform' spec='Uniform' weight="{{tree_weight}}" tree="@tree"/&gt;
        """

[templates]
clock_model = "clock_strict.toml"

[defaults]
chain_length = 1e5
tree_weight = 10</code></pre>
<p>The purpose of beter configs is to store default values of parameters, instead of having to pass them to the <code>process_template</code> function, and to store chunks of XML code. Through these templates, the BEAST2 XML can be chopped into individual models (if required), which can be defined in a single file, together with their parameters, priors, operators and loggers. Using these templates, analysis can be then easily redefined as just selection of particular models, like in the above example, where the <code>clock_model</code> is specified to a config file that specifies the model and all its particulars.</p>
</div>
<div class="section level2">
<h2 id="parsing-rules">Parsing rules<a class="anchor" aria-label="anchor" href="#parsing-rules"></a>
</h2>
<p><code>beter</code> configs consist of three parts, the <code>[xml]</code> block, <code>[templates]</code> block and <code>[defaults]</code> block. Each block consist of series of items, which should be of form <code>name = value</code>.</p>
<p>Character values need to be wrapped in quotation marks, numerical values should not be wrapped in quotation marks (<code>"10"</code> is treated as character type otherwise). You can use scientific notations for scientific notation. For more detailed description of TOML format, see [TOML webpage][<a href="https://toml.io/" class="external-link uri">https://toml.io/</a>).</p>
<p><code>[xml]</code> block should be used for XML chunks, you can use three quotation marks <code>"""</code> for multi-line value. These chunks can contain tags <code>"{{...}}"</code> and are evaluated first before they are placed in the template.</p>
<p><code>[defaults]</code> are used as a default values for tags, both in the XML template and XML chunks contained in the config. They can be overriden during the <code>process_template</code> call by passing a list of values using the <code>parameter</code> variable:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># default of "chain_length" was set to 1e5 </span>
<span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"chain_length"</span> <span class="op">=</span> <span class="fl">2e5</span><span class="op">)</span>
<span class="fu">beter</span><span class="fu">::</span><span class="fu"><a href="../reference/process_template.html">process_template</a></span><span class="op">(</span><span class="va">template</span>, <span class="va">output</span>, <span class="va">config</span>, parameters<span class="op">=</span><span class="va">parameters</span><span class="op">)</span>
<span class="co"># template is evaluated with "chain_length" set to 2e5</span></code></pre></div>
<p>Finally, the <code>[templates]</code> block allow using additional subconfigs. Here the parsing gets little difficult. When using subconfigs, the behaviour of the <code>[xml]</code> and <code>[defaults]</code> block differs:</p>
<ul>
<li>
<code>[defaults]</code> in the subconfig with the same name are replaced (overriden) by <code>[defaults]</code> in the config (and xml chunks are evaluated in this context)</li>
<li>
<code>[xml]</code> in the subconfig are <em>added</em> to <code>[xml]</code> in the config</li>
</ul>
<p>This allows each subconfig to define chunks such as <code>loggers</code>, <code>operators</code> and <code>parameters</code> for their particular model, which are then collected and inserted in the XML template. To insert these collected values (or in fact, any vector, such as <code>numbers = [1, 2, 3, 4, 5]</code>, you need to use a special form of a tag in your XML template: <code>{{#name}}{{{.}}}{{/name}}</code>. For example, for the vector of numbers, we would use</p>
<pre><code>{{#numbers}}
    {{{.}}}
{{/numbers}}</code></pre>
<p>which would result in:</p>
<pre><code><span class="fl">1</span>
    <span class="fl">2</span>
    <span class="fl">3</span>
    <span class="fl">4</span>
    <span class="fl">5</span></code></pre>
<p>after translation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jiří Moravec.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
