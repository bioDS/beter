<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="beter">
<title>Introduction to beter • beter</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to beter">
<meta property="og:description" content="beter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">beter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/beter.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/config.html">Understanding configuration files</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/biods/beter/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="beter_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to beter</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biods/beter/blob/HEAD/vignettes/beter.Rmd" class="external-link"><code>vignettes/beter.Rmd</code></a></small>
      <div class="d-none name"><code>beter.Rmd</code></div>
    </div>

    
    
<p>Create <a href="https://www.beast2.org/" class="external-link">BEAST2</a> XML files from individual XML chunks using <a href="https://mustache.github.io/" class="external-link">{{ moustache }}</a> templating system and <a href="https://github.com/toml-lang/toml" class="external-link">TOML</a> configuration files.</p>
<p>The <code>beter</code> package provides you with tools to make XML templates and subtemplates, which you can parametrize with <code>{{ mustache }}</code> tags in a clean TOML config.</p>
<p>The <code>beter</code> package allows you to: * write XML templates with <code>{{ mustache }}</code> tags * <code>{{ mustache }}</code> tags are replaced by values in TOML config * structure your TOML config with additional subconfigs</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Currently, <code>beter</code> is available only on github. To install from github, type:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"biods/beter"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<div class="section level3">
<h3 id="building-beast2-xml-is-tedious">Building BEAST2 XML is tedious<a class="anchor" aria-label="anchor" href="#building-beast2-xml-is-tedious"></a>
</h3>
<p><a href="https://www.beast2.org/" class="external-link">BEAST2</a> is a great tool for phylogenetic analysis. It contains a large amount of models, with even more models available through BEAST2 packages. To run analysis with BEAST2, you have to create an XML file that in detail specifies which kind of models are you using, together with their parameters, priors, operators and so on. This is tedious to do by hand so and BEAST2 provides a GUI tool for this called BEAUTi. However, not all BEAST2 packages contain a BEAUTi templates, required for the BEAUTi GUI. And even when they do, not all configurations are available through GUI and manual editing is required. When you need to run multiple analyses, have a data pipeline, or just want to do reproducible research, GUI tool is not ideal and there is a need to build XMLs programatically.</p>
</div>
<div class="section level3">
<h3 id="current-tools-are-insufficient">Current tools are insufficient<a class="anchor" aria-label="anchor" href="#current-tools-are-insufficient"></a>
</h3>
<p><a href="http://www.beast2.org/2018/03/09/10-ways-to-generate-beast-xml.html" class="external-link">Multiple tools</a> already exist for this purpose, namely <a href="http://phylo.wikidot.com/beastmaster" class="external-link">BeastMaster</a>, <a href="https://beastling.readthedocs.io" class="external-link">beastling</a> and <a href="https://github.com/ropensci/babette" class="external-link">babette</a>. And they work great if you need to run one of the supported analysis. But when you run some brand new model or if you are developing new BEAST2 package, you will have to edit your XML manually again or roll your own sollution involving regular expressions.</p>
</div>
<div class="section level3">
<h3 id="beter-provides-flexibility">beter provides flexibility<a class="anchor" aria-label="anchor" href="#beter-provides-flexibility"></a>
</h3>
<p>In the end, no tool is future proof to support new packages and editing XMLs manually is required. The <code>beter</code> package is here for when you are forced to edit XMLs, but don’t want to edit them again and again.</p>
<p>In short, the <code>beter</code> package allows you to: * write XML templates with <code>{{ mustache }}</code> tags * <code>{{ mustache }}</code> tags are replaced by values in TOML config * structure your TOML config with additional subconfigs</p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Often, we need to run the same file with a few changes:</p>
<ul>
<li>new sequences are added</li>
<li>bump up the number of generations to increase ESS</li>
</ul>
<p>Start with taking a functional XML, you can create it with BEAUTi or take a provided example XML from BEAST package creators. Here we have <code>primates.xml</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">&lt;!--primates.xml--&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">&lt;beast&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>...</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">&lt;data</span><span class="ot"> id=</span><span class="st">"primates"</span><span class="ot"> dataType=</span><span class="st">"nucleotide"</span><span class="kw">&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="kw">&lt;sequence</span><span class="ot"> taxon=</span><span class="st">"Tarsius_syrichta"</span><span class="kw">&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>        AAGTTTCATTGGAGCCACCACTCTTATAATTGCCCATGGCCTCACCTCCTCCCTATTAT</span>
<span id="cb2-7"><a href="#cb2-7"></a>        TTTGCCTAGCAAATACAAACTACGAACGAGTCCACAGTCGAACAATAGCACTAGCCCGT</span>
<span id="cb2-8"><a href="#cb2-8"></a>        GGCCTTCAAACCCTATTACCTCTTGCAGCAACATGATGACTCCTCGCCAGCTTAACCAA</span>
<span id="cb2-9"><a href="#cb2-9"></a>        CCTGGCCCTTCCCCCAACAATTAATTTAATCGGTGAACTGTCCGTAATAATAGCAGCAT</span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="kw">&lt;/sequence&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>...</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="kw">&lt;/data&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>...</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="kw">&lt;run</span><span class="ot"> spec=</span><span class="st">"MCMC"</span><span class="ot"> id=</span><span class="st">"mcmc"</span><span class="ot"> chainLength=</span><span class="st">"5000000"</span><span class="ot"> preBurnin=</span><span class="st">"50000"</span><span class="kw">&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>...</span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="kw">&lt;/beast&gt;</span></span></code></pre></div>
<p>To create <code>beter</code> template, simply replace elements with <code>{{ mustache }}</code> tags:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">&lt;!--template.xml--&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">&lt;beast&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>{{{sequences}}</span>
<span id="cb3-4"><a href="#cb3-4"></a>...</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">&lt;run</span><span class="ot"> spec=</span><span class="st">"MCMC"</span><span class="ot"> id=</span><span class="st">"mcmc"</span><span class="ot"> chainLength=</span><span class="st">"{{chain_length}}"</span><span class="ot"> preBurnin=</span><span class="st">"50000"</span><span class="kw">&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>...</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw">&lt;/beast&gt;</span></span></code></pre></div>
<p>You also should replace every occurence of the <code>idref='primates'</code> and <code>@primates</code> with <code>idref='{{alignment_id}}'</code> and <code>@{{alignment_id}}</code> as various models in BEAST2 refer to this alignment data block.</p>
<p>Now by running:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">beter</span><span class="fu">::</span><span class="fu"><a href="../reference/process_template.html">process_template</a></span><span class="op">(</span>
    <span class="st">"template.xml"</span>, <span class="st">"primates.xml"</span>,
    alignment <span class="op">=</span> <span class="st">"primates.fasta"</span>,
    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"chain_length"</span><span class="op">=</span><span class="fl">5</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p><code>beter</code> will replace the <code>{{chain_length}}</code> with the value specified in the <code>parameters</code> argument. The <code>{{{sequences}}}</code> tags is special and will be replaced by the data block of sequences. The <code>{{alignment_id}}</code> tag is also special variable, <code>alginment_id</code> will be constructed out of the sequence file passed to the <code>alignment</code> parameter (in this case <code>primates.fasta</code>). This allows to programatically create BEAST2 XMLs out of <code>beter</code> templates. The difference between two <code>{{</code> and three <code>{{{</code> compound brackets is that a <code>{{{</code> does not interpret XML tags parsed to it, while <code>{{</code> tries to escape any special characters.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jiří Moravec.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
